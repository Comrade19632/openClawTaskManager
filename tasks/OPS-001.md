# OPS-001 — Проверка/деплой TaskManager (docker compose + nginx)

> Примечание: этот файл — агрегатор. Дополнение/упрощённая версия чеклиста: `OPS-001-deploy-routing-smoke.md`.

## Контекст
Проект **TaskManager** развёрнут на VM `vm161818.xxvps.net` через `docker compose` (сервисы: `frontend`, `backend`, `db`) и доступен через **nginx** под префиксом:
- UI: `https://vm161818.xxvps.net/taskManager/`
- API health: `https://vm161818.xxvps.net/taskManager/api/health/`

Цель задачи — убедиться, что после мерджей FE/BE всё поднято, проксирование nginx корректное, health-check проходит, и есть понятные команды проверки/перезапуска/отката.

## Acceptance Criteria (Готово)
- [ ] `docker compose ps` показывает `db` healthy, `backend` и `frontend` в статусе Up.
- [ ] `GET https://vm161818.xxvps.net/taskManager/` возвращает **200** и HTML фронтенда.
- [ ] `GET https://vm161818.xxvps.net/taskManager/api/health/` возвращает **200** и JSON `{"status":"ok"}`.
- [ ] Зафиксированы команды для: проверки статуса/логов, health, перезапуска.

## Как проверить
В каталоге проекта:
```bash
cd /root/.openclaw/workspace/projects/openClawTaskManager

docker compose ps

docker compose logs -n 200 --no-color backend
docker compose logs -n 200 --no-color frontend
```

Проверка через nginx (prod-path):
```bash
curl -fsS -o /dev/null -D- https://vm161818.xxvps.net/taskManager/
curl -fsS https://vm161818.xxvps.net/taskManager/api/health/
```

Проверка напрямую (минуя nginx):
```bash
curl -fsS http://127.0.0.1:8010/taskManager/api/health/
curl -fsS -o /dev/null -D- http://127.0.0.1:5180/
```

## Перезапуск/обновление после мерджа
> В текущей конфигурации используются dev-серверы с volumes (`./backend:/app`, `./frontend:/app`), но при изменении зависимостей/окружения может потребоваться пересборка.

Мягкий рестарт:
```bash
docker compose restart backend frontend
```

Полный пересбор + запуск:
```bash
docker compose up -d --build
```

## Риски / заметки
- Используются **dev servers** (Django `runserver`, Vite `npm run dev`). Это удобно для MVP, но:
  - может быть нестабильно под нагрузкой;
  - `npm install` выполняется при каждом старте контейнера;
  - лучше перейти на production build (Vite build + static, gunicorn/uvicorn) и healthchecks.
- Путь API в Django фиксирован как `/taskManager/api/…` (см. `backend/config/urls.py`). Nginx проксирует `/taskManager/api/` на порт backend (8010).

## Откат
- Быстрый откат на предыдущий коммит + пересборка:
```bash
cd /root/.openclaw/workspace/projects/openClawTaskManager

git log -10 --oneline
# выбрать нужный SHA
git checkout <SHA>
docker compose up -d --build
```
- Возврат на main:
```bash
git checkout main
```
